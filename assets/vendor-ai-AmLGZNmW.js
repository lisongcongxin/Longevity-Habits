import{c as e,S as t,z as s,t as n,a as o,u as r,s as a,i,b as l,l as u,n as p,d as c,e as d,r as m,f as h,o as g,g as f,h as y,j as v,k as w,m as b,p as _,B as x,K as I,q as T,v as k,w as S,x as E,y as R,A as j,C as N,D as A,E as C,F as M,G as O,H as P,I as $,J as q,L as D}from"./vendor-uJMtiGQS.js";var U,F="vercel.ai.error",B=Symbol.for(F),V=class e extends Error{constructor({name:e,message:t,cause:s}){super(t),this[U]=!0,this.name=e,this.cause=s}static isInstance(t){return e.hasMarker(t,F)}static hasMarker(e,t){const s=Symbol.for(t);return null!=e&&"object"==typeof e&&s in e&&"boolean"==typeof e[s]&&!0===e[s]}};U=B;var J,L=V,H="AI_APICallError",W=`vercel.ai.error.${H}`,K=Symbol.for(W),G=class extends L{constructor({message:e,url:t,requestBodyValues:s,statusCode:n,responseHeaders:o,responseBody:r,cause:a,isRetryable:i=null!=n&&(408===n||409===n||429===n||n>=500),data:l}){super({name:H,message:e,cause:a}),this[J]=!0,this.url=t,this.requestBodyValues=s,this.statusCode=n,this.responseHeaders=o,this.responseBody=r,this.isRetryable=i,this.data=l}static isInstance(e){return L.hasMarker(e,W)}};J=K;var z,Y="AI_EmptyResponseBodyError",X=`vercel.ai.error.${Y}`,Z=Symbol.for(X),Q=class extends L{constructor({message:e="Empty response body"}={}){super({name:Y,message:e}),this[z]=!0}static isInstance(e){return L.hasMarker(e,X)}};function ee(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}z=Z;var te,se="AI_InvalidArgumentError",ne=`vercel.ai.error.${se}`,oe=Symbol.for(ne),re=class extends L{constructor({message:e,cause:t,argument:s}){super({name:se,message:e,cause:t}),this[te]=!0,this.argument=s}static isInstance(e){return L.hasMarker(e,ne)}};te=oe;var ae,ie="AI_InvalidPromptError",le=`vercel.ai.error.${ie}`,ue=Symbol.for(le),pe=class extends L{constructor({prompt:e,message:t,cause:s}){super({name:ie,message:`Invalid prompt: ${t}`,cause:s}),this[ae]=!0,this.prompt=e}static isInstance(e){return L.hasMarker(e,le)}};ae=ue;var ce,de="AI_InvalidResponseDataError",me=`vercel.ai.error.${de}`,he=Symbol.for(me),ge=class extends L{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:de,message:t}),this[ce]=!0,this.data=e}static isInstance(e){return L.hasMarker(e,me)}};ce=he;var fe,ye="AI_JSONParseError",ve=`vercel.ai.error.${ye}`,we=Symbol.for(ve),be=class extends L{constructor({text:e,cause:t}){super({name:ye,message:`JSON parsing failed: Text: ${e}.\nError message: ${ee(t)}`,cause:t}),this[fe]=!0,this.text=e}static isInstance(e){return L.hasMarker(e,ve)}};fe=we;var _e,xe="AI_LoadAPIKeyError",Ie=`vercel.ai.error.${xe}`,Te=Symbol.for(Ie),ke=class extends L{constructor({message:e}){super({name:xe,message:e}),this[_e]=!0}static isInstance(e){return L.hasMarker(e,Ie)}};_e=Te;var Se,Ee="AI_TooManyEmbeddingValuesForCallError",Re=`vercel.ai.error.${Ee}`,je=Symbol.for(Re),Ne=class extends L{constructor(e){super({name:Ee,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Se]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return L.hasMarker(e,Re)}};Se=je;var Ae,Ce="AI_TypeValidationError",Me=`vercel.ai.error.${Ce}`,Oe=Symbol.for(Me);Ae=Oe;var Pe,$e=class e extends L{constructor({value:e,cause:t}){super({name:Ce,message:`Type validation failed: Value: ${JSON.stringify(e)}.\nError message: ${ee(t)}`,cause:t}),this[Ae]=!0,this.value=e}static isInstance(e){return L.hasMarker(e,Me)}static wrap({value:t,cause:s}){return e.isInstance(s)&&s.value===t?s:new e({value:t,cause:s})}},qe="AI_UnsupportedFunctionalityError",De=`vercel.ai.error.${qe}`,Ue=Symbol.for(De),Fe=class extends L{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:qe,message:t}),this[Pe]=!0,this.functionality=e}static isInstance(e){return L.hasMarker(e,De)}};function Be(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(Be):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&Be(t)))}function Ve(e){return Array.isArray(e)&&e.every(Be)}function Je(e){return null!=e&&"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&Be(t))}Pe=Ue;var Le={};function He(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function We(){let e,t,s,n="",o=[];function r(e,t){if(""===e)return void a(t);if(e.startsWith(":"))return;const s=e.indexOf(":");if(-1===s)return void i(e,"");const n=s+1;i(e.slice(0,s),n<e.length&&" "===e[n]?e.slice(n+1):e.slice(n))}function a(n){o.length>0&&(n.enqueue({event:e,data:o.join("\n"),id:t,retry:s}),o=[],e=void 0,s=void 0)}function i(n,r){switch(n){case"event":e=r;break;case"data":o.push(r);break;case"id":t=r;break;case"retry":const n=parseInt(r,10);isNaN(n)||(s=n)}}return new TransformStream({transform(e,t){const{lines:s,incompleteLine:o}=function(e,t){const s=[];let n=e;for(let o=0;o<t.length;){const e=t[o++];"\n"===e?(s.push(n),n=""):"\r"===e?(s.push(n),n="","\n"===t[o]&&o++):n+=e}return{lines:s,incompleteLine:n}}(n,e);n=o;for(let n=0;n<s.length;n++)r(s[n],t)},flush(e){r(n,e),a(e)}})}function Ke(e){const t={};return e.headers.forEach((e,s)=>{t[s]=e}),t}var Ge=({prefix:t,size:s=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{const r=e(n,s);if(null==t)return r;if(n.includes(o))throw new re({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return e=>`${t}${o}${r(e)}`},ze=Ge();function Ye(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}function Xe({apiKey:e,environmentVariableName:t,apiKeyParameterName:s="apiKey",description:n}){if("string"==typeof e)return e;if(null!=e)throw new ke({message:`${n} API key must be a string.`});if("undefined"==typeof process)throw new ke({message:`${n} API key is missing. Pass it using the '${s}' parameter. Environment variables is not supported in this environment.`});if(null==(e=Le[t]))throw new ke({message:`${n} API key is missing. Pass it using the '${s}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new ke({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var Ze=Symbol.for("vercel.ai.validator");function Qe(e){return function(e){return"object"==typeof e&&null!==e&&Ze in e&&!0===e[Ze]&&"validate"in e}(e)?e:(t=e,s=e=>{const s=t.safeParse(e);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}},{[Ze]:!0,validate:s});var t,s}function et({value:e,schema:t}){const s=Qe(t);try{if(null==s.validate)return{success:!0,value:e};const t=s.validate(e);return t.success?t:{success:!1,error:$e.wrap({value:e,cause:t.error})}}catch(n){return{success:!1,error:$e.wrap({value:e,cause:n})}}}function tt({text:e,schema:s}){try{const n=t.parse(e);return null==s?n:function({value:e,schema:t}){const s=et({value:e,schema:t});if(!s.success)throw $e.wrap({value:e,cause:s.error});return s.value}({value:n,schema:s})}catch(n){if(be.isInstance(n)||$e.isInstance(n))throw n;throw new be({text:e,cause:n})}}function st({text:e,schema:s}){try{const n=t.parse(e);if(null==s)return{success:!0,value:n,rawValue:n};const o=et({value:n,schema:s});return o.success?{...o,rawValue:n}:o}catch(n){return{success:!1,error:be.isInstance(n)?n:new be({text:e,cause:n})}}}function nt(e){try{return t.parse(e),!0}catch(s){return!1}}function ot({provider:e,providerOptions:t,schema:s}){if(null==(null==t?void 0:t[e]))return;const n=et({value:t[e],schema:s});if(!n.success)throw new re({argument:"providerOptions",message:`invalid ${e} provider options`,cause:n.error});return n.value}var rt=()=>globalThis.fetch,at=async({url:e,headers:t,body:s,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a})=>it({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(s),values:s},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a}),it=async({url:e,headers:t={},body:s,successfulResponseHandler:n,failedResponseHandler:o,abortSignal:r,fetch:a=rt()})=>{try{const u=await a(e,{method:"POST",headers:(i=t,Object.fromEntries(Object.entries(i).filter(([e,t])=>null!=t))),body:s.content,signal:r}),p=Ke(u);if(!u.ok){let t;try{t=await o({response:u,url:e,requestBodyValues:s.values})}catch(l){if(Ye(l)||G.isInstance(l))throw l;throw new G({message:"Failed to process error response",cause:l,statusCode:u.status,url:e,responseHeaders:p,requestBodyValues:s.values})}throw t.value}try{return await n({response:u,url:e,requestBodyValues:s.values})}catch(l){if(l instanceof Error&&(Ye(l)||G.isInstance(l)))throw l;throw new G({message:"Failed to process successful response",cause:l,statusCode:u.status,url:e,responseHeaders:p,requestBodyValues:s.values})}}catch(l){if(Ye(l))throw l;if(l instanceof TypeError&&"fetch failed"===l.message){const t=l.cause;if(null!=t)throw new G({message:`Cannot connect to API: ${t.message}`,cause:t,url:e,requestBodyValues:s.values,isRetryable:!0})}throw l}var i},lt=e=>async({response:t})=>{const s=Ke(t);if(null==t.body)throw new Q({});return{responseHeaders:s,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(We()).pipeThrough(new TransformStream({transform({data:t},s){"[DONE]"!==t&&s.enqueue(st({text:t,schema:e}))}}))}},ut=e=>async({response:t,url:s,requestBodyValues:n})=>{const o=await t.text(),r=st({text:o,schema:e}),a=Ke(t);if(!r.success)throw new G({message:"Invalid JSON response",cause:r.error,statusCode:t.status,responseHeaders:a,responseBody:o,url:s,requestBodyValues:n});return{responseHeaders:a,value:r.value,rawValue:r.rawValue}},{btoa:pt,atob:ct}=globalThis;function dt(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),s=ct(t);return Uint8Array.from(s,e=>e.codePointAt(0))}function mt(e){let t="";for(let s=0;s<e.length;s++)t+=String.fromCodePoint(e[s]);return pt(t)}var ht={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},gt={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},ft={code:"4",name:"assistant_message",parse:e=>{if(!(null!=e&&"object"==typeof e&&"id"in e&&"role"in e&&"content"in e&&"string"==typeof e.id&&"string"==typeof e.role&&"assistant"===e.role&&Array.isArray(e.content)&&e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value)))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},yt={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},vt={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}};function wt(e){const t=["ROOT"];let s=-1,n=null;function o(e,o,r){switch(e){case'"':s=o,t.pop(),t.push(r),t.push("INSIDE_STRING");break;case"f":case"t":case"n":s=o,n=o,t.pop(),t.push(r),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(r),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s=o,t.pop(),t.push(r),t.push("INSIDE_NUMBER");break;case"{":s=o,t.pop(),t.push(r),t.push("INSIDE_OBJECT_START");break;case"[":s=o,t.pop(),t.push(r),t.push("INSIDE_ARRAY_START")}}function r(e,n){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":s=n,t.pop()}}function a(e,n){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":s=n,t.pop()}}for(let l=0;l<e.length;l++){const i=e[l];switch(t[t.length-1]){case"ROOT":o(i,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":s=l,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":if('"'===i)t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"INSIDE_OBJECT_KEY":if('"'===i)t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break;case"INSIDE_OBJECT_AFTER_KEY":if(":"===i)t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break;case"INSIDE_OBJECT_BEFORE_VALUE":o(i,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":r(i,l);break;case"INSIDE_STRING":switch(i){case'"':t.pop(),s=l;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:s=l}break;case"INSIDE_ARRAY_START":if("]"===i)s=l,t.pop();else s=l,o(i,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":s=l,t.pop();break;default:s=l}break;case"INSIDE_ARRAY_AFTER_COMMA":o(i,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),s=l;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s=l;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(i,l),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&r(i,l);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&r(i,l);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(i,l);break;default:t.pop()}break;case"INSIDE_LITERAL":{const o=e.substring(n,l+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?s=l:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?r(i,l):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(i,l));break}}}let i=e.slice(0,s+1);for(let l=t.length-1;l>=0;l--){switch(t[l]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{const t=e.substring(n,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}}return i}[ht,gt,ft,yt,vt].map(e=>e.code);var bt=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data||!("mimeType"in e)||"string"!=typeof e.mimeType)throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}];function _t(e,t){const s=bt.find(t=>t.name===e);if(!s)throw new Error(`Invalid stream part type: ${e}`);return`${s.code}:${JSON.stringify(t)}\n`}function xt(e,t){const n=null!=void 0&&undefined;return function(e,{validate:t}={}){return{[It]:!0,_type:void 0,[Ze]:!0,jsonSchema:e,validate:t}}(s(e,{$refStrategy:n?"root":"none",target:"jsonSchema7"}),{validate:t=>{const s=e.safeParse(t);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}Object.fromEntries(bt.map(e=>[e.code,e])),Object.fromEntries(bt.map(e=>[e.name,e.code])),bt.map(e=>e.code);var It=Symbol.for("vercel.ai.schema");function Tt(e){return"object"==typeof(t=e)&&null!==t&&It in t&&!0===t[It]&&"jsonSchema"in t&&"validate"in t?e:xt(e);var t}var kt=Object.defineProperty,St=(e,t)=>{for(var s in t)kt(e,s,{get:t[s],enumerable:!0})};function Et(e,{contentType:t,dataStreamVersion:s}){const n=new Headers(null!=e?e:{});return n.has("Content-Type")||n.set("Content-Type",t),void 0!==s&&n.set("X-Vercel-AI-Data-Stream",s),n}var Rt,jt=class extends L{constructor(){super({name:"AI_UnsupportedModelVersionError",message:'Unsupported model version. AI SDK 4 only supports models that implement specification version "v1". Please upgrade to AI SDK 5 to use this model.'})}},Nt="AI_InvalidArgumentError",At=`vercel.ai.error.${Nt}`,Ct=Symbol.for(At),Mt=class extends L{constructor({parameter:e,value:t,message:s}){super({name:Nt,message:`Invalid argument for parameter ${e}: ${s}`}),this[Rt]=!0,this.parameter=e,this.value=t}static isInstance(e){return L.hasMarker(e,At)}};Rt=Ct;var Ot,Pt="AI_RetryError",$t=`vercel.ai.error.${Pt}`,qt=Symbol.for($t),Dt=class extends L{constructor({message:e,reason:t,errors:s}){super({name:Pt,message:e}),this[Ot]=!0,this.reason=t,this.errors=s,this.lastError=s[s.length-1]}static isInstance(e){return L.hasMarker(e,$t)}};Ot=qt;var Ut=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:s=2}={})=>async n=>Ft(n,{maxRetries:e,delayInMs:t,backoffFactor:s});async function Ft(e,{maxRetries:t,delayInMs:s,backoffFactor:n},o=[]){try{return await e()}catch(r){if(Ye(r))throw r;if(0===t)throw r;const a=function(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}(r),i=[...o,r],l=i.length;if(l>t)throw new Dt({message:`Failed after ${l} attempts. Last error: ${a}`,reason:"maxRetriesExceeded",errors:i});if(r instanceof Error&&G.isInstance(r)&&!0===r.isRetryable&&l<=t)return await async function(e){return null==e?Promise.resolve():new Promise(t=>setTimeout(t,e))}(s),Ft(e,{maxRetries:t,delayInMs:n*s,backoffFactor:n},i);if(1===l)throw r;throw new Dt({message:`Failed after ${l} attempts with non-retryable error: '${a}'`,reason:"errorNotRetryable",errors:i})}}function Bt({operationId:e,telemetry:t}){return{"operation.name":`${e}${null!=(null==t?void 0:t.functionId)?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}var Vt={startSpan:()=>Jt,startActiveSpan:(e,t,s,n)=>"function"==typeof t?t(Jt):"function"==typeof s?s(Jt):"function"==typeof n?n(Jt):void 0},Jt={spanContext:()=>Lt,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},Lt={traceId:"",spanId:"",traceFlags:0};function Ht({name:e,tracer:t,attributes:s,fn:n,endWhenDone:r=!0}){return t.startActiveSpan(e,{attributes:s},async e=>{try{const t=await n(e);return r&&e.end(),t}catch(t){try{!function(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:o.ERROR,message:t.message})):e.setStatus({code:o.ERROR})}(e,t)}finally{e.end()}throw t}})}function Wt({telemetry:e,attributes:t}){return!0!==(null==e?void 0:e.isEnabled)?{}:Object.entries(t).reduce((t,[s,n])=>{if(void 0===n)return t;if("object"==typeof n&&"input"in n&&"function"==typeof n.input){if(!1===(null==e?void 0:e.recordInputs))return t;const o=n.input();return void 0===o?t:{...t,[s]:o}}if("object"==typeof n&&"output"in n&&"function"==typeof n.output){if(!1===(null==e?void 0:e.recordOutputs))return t;const o=n.output();return void 0===o?t:{...t,[s]:o}}return{...t,[s]:n}},{})}var Kt=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}];function Gt(e){return"string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?(e=>{const t="string"==typeof e?dt(e):e,s=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(s+10)})(e):e}var zt,Yt="AI_NoObjectGeneratedError",Xt=`vercel.ai.error.${Yt}`,Zt=Symbol.for(Xt),Qt=class extends L{constructor({message:e="No object generated.",cause:t,text:s,response:n,usage:o,finishReason:r}){super({name:Yt,message:e,cause:t}),this[zt]=!0,this.text=s,this.response=n,this.usage=o,this.finishReason=r}static isInstance(e){return L.hasMarker(e,Xt)}};zt=Zt;var es,ts="AI_DownloadError",ss=`vercel.ai.error.${ts}`,ns=Symbol.for(ss),os=class extends L{constructor({url:e,statusCode:t,statusText:s,cause:n,message:o=(null==n?`Failed to download ${e}: ${t} ${s}`:`Failed to download ${e}: ${n}`)}){super({name:ts,message:o,cause:n}),this[es]=!0,this.url=e,this.statusCode=t,this.statusText=s}static isInstance(e){return L.hasMarker(e,ss)}};async function rs({url:e}){var t;const s=e.toString();try{const e=await fetch(s);if(!e.ok)throw new os({url:s,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(n){if(os.isInstance(n))throw n;throw new os({url:s,cause:n})}}es=ns;var as,is="AI_InvalidDataContentError",ls=`vercel.ai.error.${is}`,us=Symbol.for(ls),ps=class extends L{constructor({content:e,cause:t,message:s=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:is,message:s,cause:t}),this[as]=!0,this.content=e}static isInstance(e){return L.hasMarker(e,ls)}};as=us;var cs=r([a(),i(Uint8Array),i(ArrayBuffer),l(e=>{var t,s;return null!=(s=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&s},{message:"Must be a Buffer"})]);function ds(e){return"string"==typeof e?e:e instanceof ArrayBuffer?mt(new Uint8Array(e)):mt(e)}function ms(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return dt(e)}catch(t){throw new ps({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new ps({content:e})}function hs(e){try{return(new TextDecoder).decode(e)}catch(t){throw new Error("Error decoding Uint8Array to text")}}var gs,fs="AI_InvalidMessageRoleError",ys=`vercel.ai.error.${fs}`,vs=Symbol.for(ys),ws=class extends L{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:fs,message:t}),this[gs]=!0,this.role=e}static isInstance(e){return L.hasMarker(e,ys)}};async function bs({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:s=()=>!1,downloadImplementation:n=rs}){const o=await async function(e,t,s,n){const o=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>!("image"===e.type&&!0===s)).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!n(e)),r=await Promise.all(o.map(async e=>({url:e,data:await t({url:e})})));return Object.fromEntries(r.map(({url:e,data:t})=>[e.toString(),t]))}(e.messages,n,t,s);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>function(e,t){var s,n,o,r,a,i;const l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"user":return"string"==typeof e.content?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata}:{role:"user",content:e.content.map(e=>function(e,t){var s,n,o,r;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};let a,i,l,u=e.mimeType;const p=e.type;switch(p){case"image":a=e.image;break;case"file":a=e.data;break;default:throw new Error(`Unsupported part type: ${p}`)}try{i="string"==typeof a?new URL(a):a}catch(c){i=a}if(i instanceof URL)if("data:"===i.protocol){const{mimeType:e,base64Content:t}=function(e){try{const[t,s]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:s}}catch(c){return{mimeType:void 0,base64Content:void 0}}}(i.toString());if(null==e||null==t)throw new Error(`Invalid data URL format in part ${p}`);u=e,l=ms(t)}else{const e=t[i.toString()];e?(l=e.data,null!=u||(u=e.mimeType)):l=i}else l=ms(i);switch(p){case"image":return l instanceof Uint8Array&&(u=null!=(n=function({data:e,signatures:t}){const s=Gt(e);for(const n of t)if("string"==typeof s?s.startsWith(n.base64Prefix):s.length>=n.bytesPrefix.length&&n.bytesPrefix.every((e,t)=>s[t]===e))return n.mimeType}({data:l,signatures:Kt}))?n:u),{type:"image",image:l,mimeType:u,providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};case"file":if(null==u)throw new Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?ds(l):l,filename:e.filename,mimeType:u,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata}}}(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};case"assistant":return"string"==typeof e.content?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{var t;const s=null!=(t=e.providerOptions)?t:e.experimental_providerMetadata;switch(e.type){case"file":return{type:"file",data:e.data instanceof URL?e.data:ds(e.data),filename:e.filename,mimeType:e.mimeType,providerMetadata:s};case"reasoning":return{type:"reasoning",text:e.text,signature:e.signature,providerMetadata:s};case"redacted-reasoning":return{type:"redacted-reasoning",data:e.data,providerMetadata:s};case"text":return{type:"text",text:e.text,providerMetadata:s};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args,providerMetadata:s}}}),providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};default:throw new ws({role:l})}}(e,o))]}function _s({maxTokens:e,temperature:t,topP:s,topK:n,presencePenalty:o,frequencyPenalty:r,stopSequences:a,seed:i}){if(null!=e){if(!Number.isInteger(e))throw new Mt({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new Mt({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new Mt({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=s&&"number"!=typeof s)throw new Mt({parameter:"topP",value:s,message:"topP must be a number"});if(null!=n&&"number"!=typeof n)throw new Mt({parameter:"topK",value:n,message:"topK must be a number"});if(null!=o&&"number"!=typeof o)throw new Mt({parameter:"presencePenalty",value:o,message:"presencePenalty must be a number"});if(null!=r&&"number"!=typeof r)throw new Mt({parameter:"frequencyPenalty",value:r,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new Mt({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:s,topK:n,presencePenalty:o,frequencyPenalty:r,stopSequences:null!=a&&a.length>0?a:void 0,seed:i}}function xs(e){var t,s,n;const o=[];for(const a of e){let e;try{e=new URL(a.url)}catch(r){throw new Error(`Invalid URL: ${a.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=a.contentType)?void 0:t.startsWith("image/"))o.push({type:"image",image:e});else{if(!a.contentType)throw new Error("If the attachment is not an image, it must specify a content type");o.push({type:"file",data:e,mimeType:a.contentType})}break;case"data:":{let e,t,i;try{[e,t]=a.url.split(","),i=e.split(";")[0].split(":")[1]}catch(r){throw new Error(`Error processing data URL: ${a.url}`)}if(null==i||null==t)throw new Error(`Invalid data URL format: ${a.url}`);if(null==(s=a.contentType)?void 0:s.startsWith("image/"))o.push({type:"image",image:ms(t)});else if(null==(n=a.contentType)?void 0:n.startsWith("text/"))o.push({type:"text",text:hs(ms(t))});else{if(!a.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");o.push({type:"file",data:t,mimeType:a.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${e.protocol}`)}}return o}gs=vs;var Is,Ts="AI_MessageConversionError",ks=`vercel.ai.error.${Ts}`,Ss=Symbol.for(ks),Es=class extends L{constructor({originalMessage:e,message:t}){super({name:Ts,message:t}),this[Is]=!0,this.originalMessage=e}static isInstance(e){return L.hasMarker(e,ks)}};Is=Ss;var Rs=u(()=>r([p(),a(),c(),d(),m(a(),Rs),h(Rs)])),js=m(a(),m(a(),Rs)),Ns=h(r([g({type:f("text"),text:a()}),g({type:f("image"),data:a(),mimeType:a().optional()})])),As=g({type:f("text"),text:a(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Cs=g({type:f("image"),image:r([cs,i(URL)]),mimeType:a().optional(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Ms=g({type:f("file"),data:r([cs,i(URL)]),filename:a().optional(),mimeType:a(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Os=g({type:f("reasoning"),text:a(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Ps=g({type:f("redacted-reasoning"),data:a(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),$s=g({type:f("tool-call"),toolCallId:a(),toolName:a(),args:y(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),qs=g({type:f("tool-result"),toolCallId:a(),toolName:a(),result:y(),content:Ns.optional(),isError:d().optional(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Ds=g({role:f("system"),content:a(),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Us=g({role:f("user"),content:r([a(),h(r([As,Cs,Ms]))]),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Fs=g({role:f("assistant"),content:r([a(),h(r([As,Ms,Os,Ps,$s]))]),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Bs=g({role:f("tool"),content:h(qs),providerOptions:js.optional(),experimental_providerMetadata:js.optional()}),Vs=r([Ds,Us,Fs,Bs]);function Js({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new pe({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new pe({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new pe({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new pe({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){const s=function(e){if(!Array.isArray(e))throw new pe({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received non-array value: ${JSON.stringify(e)}`].join("\n"),cause:e});if(0===e.length)return"messages";const t=e.map(Ls);if(t.some(e=>"has-ui-specific-parts"===e))return"ui-messages";const s=t.findIndex(e=>"has-core-specific-parts"!==e&&"message"!==e);if(-1===s)return"messages";throw new pe({prompt:e,message:["messages must be an array of CoreMessage or UIMessage",`Received message of type: "${t[s]}" at index ${s}`,`messages[${s}]: ${JSON.stringify(e[s])}`].join("\n"),cause:e})}(e.messages),n="ui-messages"===s?function(e,t){var s,n;const o=null!=(s=null==t?void 0:t.tools)?s:{},r=[];for(let a=0;a<e.length;a++){const t=e[a],s=a===e.length-1,{role:i,content:l,experimental_attachments:u}=t;switch(i){case"system":r.push({role:"system",content:l});break;case"user":if(null==t.parts)r.push({role:"user",content:u?[{type:"text",text:l},...xs(u)]:l});else{const e=t.parts.filter(e=>"text"===e.type).map(e=>({type:"text",text:e.text}));r.push({role:"user",content:u?[...e,...xs(u)]:e})}break;case"assistant":{if(null!=t.parts){let e=function(){const e=[];for(const t of i)switch(t.type){case"file":case"text":e.push(t);break;case"reasoning":for(const s of t.details)switch(s.type){case"text":e.push({type:"reasoning",text:s.text,signature:s.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:s.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw new Error(`Unsupported part: ${t}`)}r.push({role:"assistant",content:e});const n=i.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);n.length>0&&r.push({role:"tool",content:n.map(e=>{if(!("result"in e))throw new Es({originalMessage:t,message:"ToolInvocation must have a result: "+JSON.stringify(e)});const{toolCallId:s,toolName:n,result:r}=e,a=o[n];return null!=(null==a?void 0:a.experimental_toToolResultContent)?{type:"tool-result",toolCallId:s,toolName:n,result:a.experimental_toToolResultContent(r),experimental_content:a.experimental_toToolResultContent(r)}:{type:"tool-result",toolCallId:s,toolName:n,result:r}})}),i=[],a=!1,s++},s=0,a=!1,i=[];for(const o of t.parts)switch(o.type){case"text":a&&e(),i.push(o);break;case"file":case"reasoning":i.push(o);break;case"tool-invocation":(null!=(n=o.toolInvocation.step)?n:0)!==s&&e(),i.push(o),a=!0}e();break}const e=t.toolInvocations;if(null==e||0===e.length){r.push({role:"assistant",content:l});break}const a=e.reduce((e,t)=>{var s;return Math.max(e,null!=(s=t.step)?s:0)},0);for(let n=0;n<=a;n++){const a=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===n});0!==a.length&&(r.push({role:"assistant",content:[...s&&l&&0===n?[{type:"text",text:l}]:[],...a.map(({toolCallId:e,toolName:t,args:s})=>({type:"tool-call",toolCallId:e,toolName:t,args:s}))]}),r.push({role:"tool",content:a.map(e=>{if(!("result"in e))throw new Es({originalMessage:t,message:"ToolInvocation must have a result: "+JSON.stringify(e)});const{toolCallId:s,toolName:n,result:r}=e,a=o[n];return null!=(null==a?void 0:a.experimental_toToolResultContent)?{type:"tool-result",toolCallId:s,toolName:n,result:a.experimental_toToolResultContent(r),experimental_content:a.experimental_toToolResultContent(r)}:{type:"tool-result",toolCallId:s,toolName:n,result:r}})}))}l&&!s&&r.push({role:"assistant",content:l});break}case"data":break;default:throw new Es({originalMessage:t,message:`Unsupported role: ${i}`})}}return r}(e.messages,{tools:t}):e.messages;if(0===n.length)throw new pe({prompt:e,message:"messages must not be empty"});const o=et({value:n,schema:h(Vs)});if(!o.success)throw new pe({prompt:e,message:["message must be a CoreMessage or a UI message",`Validation error: ${o.error.message}`].join("\n"),cause:o.error});return{type:"messages",messages:n,system:e.system}}throw new Error("unreachable")}function Ls(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function Hs({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function Ws({prompt:e,schema:t,schemaPrefix:s=(null!=t?"JSON schema:":void 0),schemaSuffix:n=(null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON.")}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,s,null!=t?JSON.stringify(t):void 0,n].filter(e=>null!=e).join("\n")}var Ks={type:"no-schema",jsonSchema:void 0,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:(e,t)=>void 0===e?{success:!1,error:new Qt({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new Fe({functionality:"element streams in no-schema mode"})}},Gs=e=>{const{$schema:t,...s}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:s}},required:["elements"],additionalProperties:!1},validatePartialResult({value:t,latestObject:s,isFirstDelta:n,isFinalDelta:o}){var r;if(!Je(t)||!Ve(t.elements))return{success:!1,error:new $e({value:t,cause:"value must be an object that contains an array of elements"})};const a=t.elements,i=[];for(let p=0;p<a.length;p++){const t=et({value:a[p],schema:e});if(p!==a.length-1||o){if(!t.success)return t;i.push(t.value)}}const l=null!=(r=null==s?void 0:s.length)?r:0;let u="";return n&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),o&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},validateFinalResult(t){if(!Je(t)||!Ve(t.elements))return{success:!1,error:new $e({value:t,cause:"value must be an object that contains an array of elements"})};const s=t.elements;for(const n of s){const t=et({value:n,schema:e});if(!t.success)return t}return{success:!0,value:s}},createElementStream(e){let t=0;return function(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const e=t.getReader();return{async next(){const{done:t,value:s}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:s}}}},t}(e.pipeThrough(new TransformStream({transform(e,s){switch(e.type){case"object":{const n=e.object;for(;t<n.length;t++)s.enqueue(n[t]);break}case"text-delta":case"finish":case"error":break;default:throw new Error(`Unsupported chunk type: ${e}`)}}})))}}};function zs({output:e,schema:t,enumValues:s}){switch(e){case"object":return(e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:t=>et({value:t,schema:e}),createElementStream(){throw new Fe({functionality:"element streams in object mode"})}}))(Tt(t));case"array":return Gs(Tt(t));case"enum":return(e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!Je(t)||"string"!=typeof t.result)return{success:!1,error:new $e({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const s=t.result;return e.includes(s)?{success:!0,value:s}:{success:!1,error:new $e({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new Fe({functionality:"partial results in enum mode"})},createElementStream(){throw new Fe({functionality:"element streams in enum mode"})}}))(s);case"no-schema":return Ks;default:throw new Error(`Unsupported output: ${e}`)}}function Ys(e){return"image"===e.type?{...e,image:e.image instanceof Uint8Array?ds(e.image):e.image}:e}var Xs=Ge({prefix:"aiobj",size:24});async function Zs({model:e,enum:t,schema:s,schemaName:o,schemaDescription:r,mode:a,output:i="object",system:l,prompt:u,messages:p,maxRetries:c,abortSignal:d,headers:m,experimental_repairText:h,experimental_telemetry:g,experimental_providerMetadata:f,providerOptions:y=f,_internal:{generateId:v=Xs,currentDate:w=()=>new Date}={},...b}){if("string"==typeof e||"v1"!==e.specificationVersion)throw new jt;!function({output:e,mode:t,schema:s,schemaName:n,schemaDescription:o,enumValues:r}){if(null!=e&&"object"!==e&&"array"!==e&&"enum"!==e&&"no-schema"!==e)throw new Mt({parameter:"output",value:e,message:"Invalid output type."});if("no-schema"===e){if("auto"===t||"tool"===t)throw new Mt({parameter:"mode",value:t,message:'Mode must be "json" for no-schema output.'});if(null!=s)throw new Mt({parameter:"schema",value:s,message:"Schema is not supported for no-schema output."});if(null!=o)throw new Mt({parameter:"schemaDescription",value:o,message:"Schema description is not supported for no-schema output."});if(null!=n)throw new Mt({parameter:"schemaName",value:n,message:"Schema name is not supported for no-schema output."});if(null!=r)throw new Mt({parameter:"enumValues",value:r,message:"Enum values are not supported for no-schema output."})}if("object"===e){if(null==s)throw new Mt({parameter:"schema",value:s,message:"Schema is required for object output."});if(null!=r)throw new Mt({parameter:"enumValues",value:r,message:"Enum values are not supported for object output."})}if("array"===e){if(null==s)throw new Mt({parameter:"schema",value:s,message:"Element schema is required for array output."});if(null!=r)throw new Mt({parameter:"enumValues",value:r,message:"Enum values are not supported for array output."})}if("enum"===e){if(null!=s)throw new Mt({parameter:"schema",value:s,message:"Schema is not supported for enum output."});if(null!=o)throw new Mt({parameter:"schemaDescription",value:o,message:"Schema description is not supported for enum output."});if(null!=n)throw new Mt({parameter:"schemaName",value:n,message:"Schema name is not supported for enum output."});if(null==r)throw new Mt({parameter:"enumValues",value:r,message:"Enum values are required for enum output."});for(const e of r)if("string"!=typeof e)throw new Mt({parameter:"enumValues",value:e,message:"Enum values must be strings."})}}({output:i,mode:a,schema:s,schemaName:o,schemaDescription:r,enumValues:t});const{maxRetries:_,retry:x}=function({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new Mt({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new Mt({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=null!=e?e:2;return{maxRetries:t,retry:Ut({maxRetries:t})}}({maxRetries:c}),I=zs({output:i,schema:s,enumValues:t});"no-schema"===I.type&&void 0===a&&(a="json");const T=function({model:e,settings:t,telemetry:s,headers:n}){var o;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,s])=>(e[`ai.settings.${t}`]=s,e),{}),...Object.entries(null!=(o=null==s?void 0:s.metadata)?o:{}).reduce((e,[t,s])=>(e[`ai.telemetry.metadata.${t}`]=s,e),{}),...Object.entries(null!=n?n:{}).reduce((e,[t,s])=>(void 0!==s&&(e[`ai.request.headers.${t}`]=s),e),{})}}({model:e,telemetry:g,headers:m,settings:{...b,maxRetries:_}}),k=function({isEnabled:e=!1,tracer:t}={}){return e?t||n.getTracer("ai"):Vt}(g);return Ht({name:"ai.generateObject",attributes:Wt({telemetry:g,attributes:{...Bt({operationId:"ai.generateObject",telemetry:g}),...T,"ai.prompt":{input:()=>JSON.stringify({system:l,prompt:u,messages:p})},"ai.schema":null!=I.jsonSchema?{input:()=>JSON.stringify(I.jsonSchema)}:void 0,"ai.schema.name":o,"ai.schema.description":r,"ai.settings.output":I.type,"ai.settings.mode":a}}),tracer:k,fn:async t=>{var s,n,i,c;let f,_,S,E,R,j,N,A,C,M;switch("auto"!==a&&null!=a||(a=e.defaultObjectGenerationMode),a){case"json":{const t=Js({prompt:{system:null==I.jsonSchema?Ws({prompt:l}):e.supportsStructuredOutputs?l:Ws({prompt:l,schema:I.jsonSchema}),prompt:u,messages:p},tools:void 0}),i=await bs({prompt:t,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(s=e.supportsUrl)?void 0:s.bind(e)}),c=await x(()=>Ht({name:"ai.generateObject.doGenerate",attributes:Wt({telemetry:g,attributes:{...Bt({operationId:"ai.generateObject.doGenerate",telemetry:g}),...T,"ai.prompt.format":{input:()=>t.type},"ai.prompt.messages":{input:()=>JSON.stringify(i)},"ai.settings.mode":a,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":b.frequencyPenalty,"gen_ai.request.max_tokens":b.maxTokens,"gen_ai.request.presence_penalty":b.presencePenalty,"gen_ai.request.temperature":b.temperature,"gen_ai.request.top_k":b.topK,"gen_ai.request.top_p":b.topP}}),tracer:k,fn:async s=>{var n,a,l,u,p,c;const h=await e.doGenerate({mode:{type:"object-json",schema:I.jsonSchema,name:o,description:r},..._s(b),inputFormat:t.type,prompt:i,providerMetadata:y,abortSignal:d,headers:m}),f={id:null!=(a=null==(n=h.response)?void 0:n.id)?a:v(),timestamp:null!=(u=null==(l=h.response)?void 0:l.timestamp)?u:w(),modelId:null!=(c=null==(p=h.response)?void 0:p.modelId)?c:e.modelId};if(void 0===h.text)throw new Qt({message:"No object generated: the model did not return a response.",response:f,usage:Hs(h.usage),finishReason:h.finishReason});return s.setAttributes(Wt({telemetry:g,attributes:{"ai.response.finishReason":h.finishReason,"ai.response.object":{output:()=>h.text},"ai.response.id":f.id,"ai.response.model":f.modelId,"ai.response.timestamp":f.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(h.providerMetadata),"ai.usage.promptTokens":h.usage.promptTokens,"ai.usage.completionTokens":h.usage.completionTokens,"gen_ai.response.finish_reasons":[h.finishReason],"gen_ai.response.id":f.id,"gen_ai.response.model":f.modelId,"gen_ai.usage.prompt_tokens":h.usage.promptTokens,"gen_ai.usage.completion_tokens":h.usage.completionTokens}})),{...h,objectText:h.text,responseData:f}}}));f=c.objectText,_=c.finishReason,S=c.usage,E=c.warnings,R=c.rawResponse,A=c.logprobs,C=c.providerMetadata,N=null!=(n=c.request)?n:{},j=c.responseData;break}case"tool":{const t=Js({prompt:{system:l,prompt:u,messages:p},tools:void 0}),s=await bs({prompt:t,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(i=e.supportsUrl)?void 0:i.bind(e)}),n=t.type,h=await x(()=>Ht({name:"ai.generateObject.doGenerate",attributes:Wt({telemetry:g,attributes:{...Bt({operationId:"ai.generateObject.doGenerate",telemetry:g}),...T,"ai.prompt.format":{input:()=>n},"ai.prompt.messages":{input:()=>function(e){const t=e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(Ys)}));return JSON.stringify(t)}(s)},"ai.settings.mode":a,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":b.frequencyPenalty,"gen_ai.request.max_tokens":b.maxTokens,"gen_ai.request.presence_penalty":b.presencePenalty,"gen_ai.request.temperature":b.temperature,"gen_ai.request.top_k":b.topK,"gen_ai.request.top_p":b.topP}}),tracer:k,fn:async t=>{var a,i,l,u,p,c,h,f;const _=await e.doGenerate({mode:{type:"object-tool",tool:{type:"function",name:null!=o?o:"json",description:null!=r?r:"Respond with a JSON object.",parameters:I.jsonSchema}},..._s(b),inputFormat:n,prompt:s,providerMetadata:y,abortSignal:d,headers:m}),x=null==(i=null==(a=_.toolCalls)?void 0:a[0])?void 0:i.args,T={id:null!=(u=null==(l=_.response)?void 0:l.id)?u:v(),timestamp:null!=(c=null==(p=_.response)?void 0:p.timestamp)?c:w(),modelId:null!=(f=null==(h=_.response)?void 0:h.modelId)?f:e.modelId};if(void 0===x)throw new Qt({message:"No object generated: the tool was not called.",response:T,usage:Hs(_.usage),finishReason:_.finishReason});return t.setAttributes(Wt({telemetry:g,attributes:{"ai.response.finishReason":_.finishReason,"ai.response.object":{output:()=>x},"ai.response.id":T.id,"ai.response.model":T.modelId,"ai.response.timestamp":T.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(_.providerMetadata),"ai.usage.promptTokens":_.usage.promptTokens,"ai.usage.completionTokens":_.usage.completionTokens,"gen_ai.response.finish_reasons":[_.finishReason],"gen_ai.response.id":T.id,"gen_ai.response.model":T.modelId,"gen_ai.usage.input_tokens":_.usage.promptTokens,"gen_ai.usage.output_tokens":_.usage.completionTokens}})),{..._,objectText:x,responseData:T}}}));f=h.objectText,_=h.finishReason,S=h.usage,E=h.warnings,R=h.rawResponse,A=h.logprobs,C=h.providerMetadata,N=null!=(c=h.request)?c:{},j=h.responseData;break}case void 0:throw new Error("Model does not have a default object generation mode.");default:throw new Error(`Unsupported mode: ${a}`)}function O(e){const t=st({text:e});if(!t.success)throw new Qt({message:"No object generated: could not parse the response.",cause:t.error,text:e,response:j,usage:Hs(S),finishReason:_});const s=I.validateFinalResult(t.value,{text:e,response:j,usage:Hs(S)});if(!s.success)throw new Qt({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:j,usage:Hs(S),finishReason:_});return s.value}try{M=O(f)}catch(P){if(null==h||!Qt.isInstance(P)||!be.isInstance(P.cause)&&!$e.isInstance(P.cause))throw P;{const e=await h({text:f,error:P.cause});if(null===e)throw P;M=O(e)}}return t.setAttributes(Wt({telemetry:g,attributes:{"ai.response.finishReason":_,"ai.response.object":{output:()=>JSON.stringify(M)},"ai.usage.promptTokens":S.promptTokens,"ai.usage.completionTokens":S.completionTokens}})),new Qs({object:M,finishReason:_,usage:Hs(S),warnings:E,request:N,response:{...j,headers:null==R?void 0:R.headers,body:null==R?void 0:R.body},logprobs:A,providerMetadata:C})}})}var Qs=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.logprobs=e.logprobs}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:Et(null==e?void 0:e.headers,{contentType:"application/json; charset=utf-8"})})}};Ge({prefix:"aiobj",size:24}),Ge({prefix:"aitxt",size:24}),Ge({prefix:"msg",size:24});St({},{object:()=>tn,text:()=>en});var en=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),tn=({schema:e})=>{const t=Tt(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:s})=>s.supportsStructuredOutputs?e:Ws({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){const t=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=st({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=st({text:wt(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{const e=t.state;throw new Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},s){const n=st({text:e});if(!n.success)throw new Qt({message:"No object generated: could not parse the response.",cause:n.error,text:e,response:s.response,usage:s.usage,finishReason:s.finishReason});const o=et({value:n.value,schema:t});if(!o.success)throw new Qt({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:s.response,usage:s.usage,finishReason:s.finishReason});return o.value}}};function sn(e,t){const s=e.getReader(),n=t.getReader();let o,r,a=!1,i=!1;async function l(e){try{null==o&&(o=s.read());const t=await o;o=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==r&&(r=n.read());const t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(a)return void(await u(e));if(i)return void(await l(e));null==o&&(o=s.read()),null==r&&(r=n.read());const{result:t,reader:p}=await Promise.race([o.then(e=>({result:e,reader:s})),r.then(e=>({result:e,reader:n}))]);t.done||e.enqueue(t.value),p===s?(o=void 0,t.done&&(await u(e),a=!0)):(r=void 0,t.done&&(i=!0,await l(e)))}catch(t){e.error(t)}},cancel(){s.cancel(),n.cancel()}})}Ge({prefix:"aitxt",size:24}),Ge({prefix:"msg",size:24});var nn=g({name:a(),version:a()}).passthrough(),on=g({_meta:v(g({}).passthrough())}).passthrough(),rn=on,an=g({method:a(),params:v(on)}),ln=g({experimental:v(g({}).passthrough()),logging:v(g({}).passthrough()),prompts:v(g({listChanged:v(d())}).passthrough()),resources:v(g({subscribe:v(d()),listChanged:v(d())}).passthrough()),tools:v(g({listChanged:v(d())}).passthrough())}).passthrough();rn.extend({protocolVersion:a(),capabilities:ln,serverInfo:nn,instructions:v(a())});var un=rn.extend({nextCursor:v(a())}),pn=g({name:a(),description:v(a()),inputSchema:g({type:f("object"),properties:v(g({}).passthrough())}).passthrough()}).passthrough();un.extend({tools:h(pn)});var cn=g({type:f("text"),text:a()}).passthrough(),dn=g({type:f("image"),data:a().base64(),mimeType:a()}).passthrough(),mn=g({uri:a(),mimeType:v(a())}).passthrough(),hn=mn.extend({text:a()}),gn=mn.extend({blob:a().base64()}),fn=g({type:f("resource"),resource:r([hn,gn])}).passthrough();rn.extend({content:h(r([cn,dn,fn])),isError:d().default(!1).optional()}).or(rn.extend({toolResult:y()}));var yn="2.0",vn=g({jsonrpc:f(yn),id:r([a(),c().int()])}).merge(an).strict(),wn=g({jsonrpc:f(yn),id:r([a(),c().int()]),result:rn}).strict(),bn=g({jsonrpc:f(yn),id:r([a(),c().int()]),error:g({code:c().int(),message:a(),data:v(y())})}).strict(),_n=g({jsonrpc:f(yn)}).merge(g({method:a(),params:v(on)})).strict();r([vn,_n,wn,bn]);function xn(e={}){const t=new TextEncoder;let s="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(n,o){o.enqueue(t.encode(n)),s+=n,e.onToken&&await e.onToken(n),e.onText&&"string"==typeof n&&await e.onText(n)},async flush(){e.onCompletion&&await e.onCompletion(s),e.onFinal&&await e.onFinal(s)}})}function In(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var s;"string"!=typeof e?"event"in e?"on_chat_model_stream"===e.event&&En(null==(s=e.data)?void 0:s.chunk,t):En(e,t):t.enqueue(e)}})).pipeThrough(xn(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(_t("text",e))}}))}function Tn(e,t){return In(e,t).pipeThrough(new TextEncoderStream)}function kn(e,t){var s;const n=In(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),o=null==t?void 0:t.data,r=null==t?void 0:t.init,a=o?sn(o.stream,n):n;return new Response(a,{status:null!=(s=null==r?void 0:r.status)?s:200,statusText:null==r?void 0:r.statusText,headers:Et(null==r?void 0:r.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Sn(e,t){t.dataStream.merge(In(e,t.callbacks))}function En(e,t){if("string"==typeof e.content)t.enqueue(e.content);else{const s=e.content;for(const e of s)"text"===e.type&&t.enqueue(e.text)}}St({},{mergeIntoDataStream:()=>Sn,toDataStream:()=>Tn,toDataStreamResponse:()=>kn});function Rn(e,t){const s=function(){let e=!0;return t=>(e&&(t=t.trimStart())&&(e=!1),t)}();return(n=e[Symbol.asyncIterator](),new ReadableStream({async pull(e){try{const{value:t,done:s}=await n.next();s?e.close():e.enqueue(t)}catch(t){e.error(t)}},cancel(){}})).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(s(e.delta))}})).pipeThrough(xn(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(_t("text",e))}}));var n}function jn(e,t){return Rn(e,t).pipeThrough(new TextEncoderStream)}function Nn(e,t={}){var s;const{init:n,data:o,callbacks:r}=t,a=Rn(e,r).pipeThrough(new TextEncoderStream),i=o?sn(o.stream,a):a;return new Response(i,{status:null!=(s=null==n?void 0:n.status)?s:200,statusText:null==n?void 0:n.statusText,headers:Et(null==n?void 0:n.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function An(e,t){t.dataStream.merge(Rn(e,t.callbacks))}function Cn(e){var t,s;return null!=(s=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:s})=>({token:e,logprob:t,topLogprobs:s?s.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?s:void 0}function Mn(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}St({},{mergeIntoDataStream:()=>An,toDataStream:()=>jn,toDataStreamResponse:()=>Nn});var On=g({error:g({message:a(),type:a().nullish(),param:w().nullish(),code:r([a(),c()]).nullish()})}),Pn=(({errorSchema:e,errorToMessage:t,isRetryable:s})=>async({response:n,url:o,requestBodyValues:r})=>{const a=await n.text(),i=Ke(n);if(""===a.trim())return{responseHeaders:i,value:new G({message:n.statusText,url:o,requestBodyValues:r,statusCode:n.status,responseHeaders:i,responseBody:a,isRetryable:null==s?void 0:s(n)})};try{const l=tt({text:a,schema:e});return{responseHeaders:i,value:new G({message:t(l),url:o,requestBodyValues:r,statusCode:n.status,responseHeaders:i,responseBody:a,data:l,isRetryable:null==s?void 0:s(n,l)})}}catch(l){return{responseHeaders:i,value:new G({message:n.statusText,url:o,requestBodyValues:r,statusCode:n.status,responseHeaders:i,responseBody:a,isRetryable:null==s?void 0:s(n)})}}})({errorSchema:On,errorToMessage:e=>e.error.message});function $n({id:e,model:t,created:s}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=s?new Date(1e3*s):void 0}}var qn=class{constructor(e,t,s){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=s}get supportsStructuredOutputs(){var e;return null!=(e=this.settings.structuredOutputs)?e:Bn(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:s,temperature:n,topP:o,topK:r,frequencyPenalty:a,presencePenalty:i,stopSequences:l,responseFormat:u,seed:p,providerMetadata:c}){var d,m,h,g,f,y,v,w;const b=e.type,_=[];null!=r&&_.push({type:"unsupported-setting",setting:"topK"}),"json"!==(null==u?void 0:u.type)||null==u.schema||this.supportsStructuredOutputs||_.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const x=this.settings.useLegacyFunctionCalling;if(x&&!0===this.settings.parallelToolCalls)throw new Fe({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(x&&this.supportsStructuredOutputs)throw new Fe({functionality:"structuredOutputs with useLegacyFunctionCalling"});const{messages:I,warnings:T}=function({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:s="system"}){const n=[],o=[];for(const{role:r,content:a}of e)switch(r){case"system":switch(s){case"system":n.push({role:"system",content:a});break;case"developer":n.push({role:"developer",content:a});break;case"remove":o.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${s}`)}break;case"user":if(1===a.length&&"text"===a[0].type){n.push({role:"user",content:a[0].text});break}n.push({role:"user",content:a.map((e,t)=>{var s,n,o,r;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(s=e.mimeType)?s:"image/jpeg"};base64,${mt(e.image)}`,detail:null==(o=null==(n=e.providerMetadata)?void 0:n.openai)?void 0:o.imageDetail}};case"file":if(e.data instanceof URL)throw new Fe({functionality:"'File content parts with URL data' functionality not supported."});switch(e.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:e.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:e.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:null!=(r=e.filename)?r:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${e.data}`}};default:throw new Fe({functionality:`File content part type ${e.mimeType} in user messages`})}}})});break;case"assistant":{let e="";const s=[];for(const t of a)switch(t.type){case"text":e+=t.text;break;case"tool-call":s.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}})}if(t){if(s.length>1)throw new Fe({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});n.push({role:"assistant",content:e,function_call:s.length>0?s[0].function:void 0})}else n.push({role:"assistant",content:e,tool_calls:s.length>0?s:void 0});break}case"tool":for(const e of a)t?n.push({role:"function",name:e.toolName,content:JSON.stringify(e.result)}):n.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw new Error(`Unsupported role: ${r}`)}return{messages:n,warnings:o}}({prompt:t,useLegacyFunctionCalling:x,systemMessageMode:Vn(this.modelId)});_.push(...T);const k={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:s,temperature:n,top_p:o,frequency_penalty:a,presence_penalty:i,response_format:"json"===(null==u?void 0:u.type)?this.supportsStructuredOutputs&&null!=u.schema?{type:"json_schema",json_schema:{schema:u.schema,strict:!0,name:null!=(d=u.name)?d:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:p,max_completion_tokens:null==(m=null==c?void 0:c.openai)?void 0:m.maxCompletionTokens,store:null==(h=null==c?void 0:c.openai)?void 0:h.store,metadata:null==(g=null==c?void 0:c.openai)?void 0:g.metadata,prediction:null==(f=null==c?void 0:c.openai)?void 0:f.prediction,reasoning_effort:null!=(v=null==(y=null==c?void 0:c.openai)?void 0:y.reasoningEffort)?v:this.settings.reasoningEffort,messages:I};switch(Bn(this.modelId)?(null!=k.temperature&&(k.temperature=void 0,_.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=k.top_p&&(k.top_p=void 0,_.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=k.frequency_penalty&&(k.frequency_penalty=void 0,_.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=k.presence_penalty&&(k.presence_penalty=void 0,_.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=k.logit_bias&&(k.logit_bias=void 0,_.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=k.logprobs&&(k.logprobs=void 0,_.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=k.top_logprobs&&(k.top_logprobs=void 0,_.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=k.max_tokens&&(null==k.max_completion_tokens&&(k.max_completion_tokens=k.max_tokens),k.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=k.temperature&&(k.temperature=void 0,_.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),b){case"regular":{const{tools:t,tool_choice:s,functions:n,function_call:o,toolWarnings:r}=function({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:s}){var n;const o=(null==(n=e.tools)?void 0:n.length)?e.tools:void 0,r=[];if(null==o)return{tools:void 0,tool_choice:void 0,toolWarnings:r};const a=e.toolChoice;if(t){const e=[];for(const t of o)"provider-defined"===t.type?r.push({type:"unsupported-tool",tool:t}):e.push({name:t.name,description:t.description,parameters:t.parameters});if(null==a)return{functions:e,function_call:void 0,toolWarnings:r};switch(a.type){case"auto":case"none":case void 0:return{functions:e,function_call:void 0,toolWarnings:r};case"required":throw new Fe({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:e,function_call:{name:a.toolName},toolWarnings:r}}}const i=[];for(const u of o)"provider-defined"===u.type?r.push({type:"unsupported-tool",tool:u}):i.push({type:"function",function:{name:u.name,description:u.description,parameters:u.parameters,strict:!!s||void 0}});if(null==a)return{tools:i,tool_choice:void 0,toolWarnings:r};const l=a.type;switch(l){case"auto":case"none":case"required":return{tools:i,tool_choice:l,toolWarnings:r};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:a.toolName}},toolWarnings:r};default:throw new Fe({functionality:`Unsupported tool choice type: ${l}`})}}({mode:e,useLegacyFunctionCalling:x,structuredOutputs:this.supportsStructuredOutputs});return{args:{...k,tools:t,tool_choice:s,functions:n,function_call:o},warnings:[..._,...r]}}case"object-json":return{args:{...k,response_format:this.supportsStructuredOutputs&&null!=e.schema?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:null!=(w=e.name)?w:"response",description:e.description}}:{type:"json_object"}},warnings:_};case"object-tool":return{args:x?{...k,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...k,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:_};default:throw new Error(`Unsupported type: ${b}`)}}async doGenerate(e){var t,s,n,o,r,a,i,l;const{args:u,warnings:p}=this.getArgs(e),{responseHeaders:c,value:d,rawValue:m}=await at({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:u,failedResponseHandler:Pn,successfulResponseHandler:ut(Un),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:h,...g}=u,f=d.choices[0],y=null==(t=d.usage)?void 0:t.completion_tokens_details,v=null==(s=d.usage)?void 0:s.prompt_tokens_details,w={openai:{}};return null!=(null==y?void 0:y.reasoning_tokens)&&(w.openai.reasoningTokens=null==y?void 0:y.reasoning_tokens),null!=(null==y?void 0:y.accepted_prediction_tokens)&&(w.openai.acceptedPredictionTokens=null==y?void 0:y.accepted_prediction_tokens),null!=(null==y?void 0:y.rejected_prediction_tokens)&&(w.openai.rejectedPredictionTokens=null==y?void 0:y.rejected_prediction_tokens),null!=(null==v?void 0:v.cached_tokens)&&(w.openai.cachedPromptTokens=null==v?void 0:v.cached_tokens),{text:null!=(n=f.message.content)?n:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&f.message.function_call?[{toolCallType:"function",toolCallId:ze(),toolName:f.message.function_call.name,args:f.message.function_call.arguments}]:null==(o=f.message.tool_calls)?void 0:o.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:ze(),toolName:e.function.name,args:e.function.arguments}}),finishReason:Mn(f.finish_reason),usage:{promptTokens:null!=(a=null==(r=d.usage)?void 0:r.prompt_tokens)?a:NaN,completionTokens:null!=(l=null==(i=d.usage)?void 0:i.completion_tokens)?l:NaN},rawCall:{rawPrompt:h,rawSettings:g},rawResponse:{headers:c,body:m},request:{body:JSON.stringify(u)},response:$n(d),warnings:p,logprobs:Cn(f.logprobs),providerMetadata:w}}async doStream(e){if(this.settings.simulateStreaming){const t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(const s of t.toolCalls)e.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:s.toolCallId,toolName:s.toolName,argsTextDelta:s.args}),e.enqueue({type:"tool-call",...s});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}const{args:t,warnings:s}=this.getArgs(e),n={...t,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:o,value:r}=await at({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:n,failedResponseHandler:Pn,successfulResponseHandler:lt(Fn),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:a,...i}=t,l=[];let u,p="unknown",c={promptTokens:void 0,completionTokens:void 0},d=!0;const{useLegacyFunctionCalling:m}=this.settings,h={openai:{}};return{stream:r.pipeThrough(new TransformStream({transform(e,t){var s,n,o,r,a,i,g,f,y,v,w,b;if(!e.success)return p="error",void t.enqueue({type:"error",error:e.error});const _=e.value;if("error"in _)return p="error",void t.enqueue({type:"error",error:_.error});if(d&&(d=!1,t.enqueue({type:"response-metadata",...$n(_)})),null!=_.usage){const{prompt_tokens:e,completion_tokens:t,prompt_tokens_details:s,completion_tokens_details:n}=_.usage;c={promptTokens:null!=e?e:void 0,completionTokens:null!=t?t:void 0},null!=(null==n?void 0:n.reasoning_tokens)&&(h.openai.reasoningTokens=null==n?void 0:n.reasoning_tokens),null!=(null==n?void 0:n.accepted_prediction_tokens)&&(h.openai.acceptedPredictionTokens=null==n?void 0:n.accepted_prediction_tokens),null!=(null==n?void 0:n.rejected_prediction_tokens)&&(h.openai.rejectedPredictionTokens=null==n?void 0:n.rejected_prediction_tokens),null!=(null==s?void 0:s.cached_tokens)&&(h.openai.cachedPromptTokens=null==s?void 0:s.cached_tokens)}const x=_.choices[0];if(null!=(null==x?void 0:x.finish_reason)&&(p=Mn(x.finish_reason)),null==(null==x?void 0:x.delta))return;const I=x.delta;null!=I.content&&t.enqueue({type:"text-delta",textDelta:I.content});const T=Cn(null==x?void 0:x.logprobs);(null==T?void 0:T.length)&&(void 0===u&&(u=[]),u.push(...T));const k=m&&null!=I.function_call?[{type:"function",id:ze(),function:I.function_call,index:0}]:I.tool_calls;if(null!=k)for(const u of k){const e=u.index;if(null==l[e]){if("function"!==u.type)throw new ge({data:u,message:"Expected 'function' type."});if(null==u.id)throw new ge({data:u,message:"Expected 'id' to be a string."});if(null==(null==(s=u.function)?void 0:s.name))throw new ge({data:u,message:"Expected 'function.name' to be a string."});l[e]={id:u.id,type:"function",function:{name:u.function.name,arguments:null!=(n=u.function.arguments)?n:""},hasFinished:!1};const i=l[e];null!=(null==(o=i.function)?void 0:o.name)&&null!=(null==(r=i.function)?void 0:r.arguments)&&(i.function.arguments.length>0&&t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:i.id,toolName:i.function.name,argsTextDelta:i.function.arguments}),nt(i.function.arguments)&&(t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(a=i.id)?a:ze(),toolName:i.function.name,args:i.function.arguments}),i.hasFinished=!0));continue}const p=l[e];p.hasFinished||(null!=(null==(i=u.function)?void 0:i.arguments)&&(p.function.arguments+=null!=(f=null==(g=u.function)?void 0:g.arguments)?f:""),t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:p.id,toolName:p.function.name,argsTextDelta:null!=(y=u.function.arguments)?y:""}),null!=(null==(v=p.function)?void 0:v.name)&&null!=(null==(w=p.function)?void 0:w.arguments)&&nt(p.function.arguments)&&(t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(b=p.id)?b:ze(),toolName:p.function.name,args:p.function.arguments}),p.hasFinished=!0))}},flush(e){var t,s;e.enqueue({type:"finish",finishReason:p,logprobs:u,usage:{promptTokens:null!=(t=c.promptTokens)?t:NaN,completionTokens:null!=(s=c.completionTokens)?s:NaN},...null!=h?{providerMetadata:h}:{}})}})),rawCall:{rawPrompt:a,rawSettings:i},rawResponse:{headers:o},request:{body:JSON.stringify(n)},warnings:s}}},Dn=g({prompt_tokens:c().nullish(),completion_tokens:c().nullish(),prompt_tokens_details:g({cached_tokens:c().nullish()}).nullish(),completion_tokens_details:g({reasoning_tokens:c().nullish(),accepted_prediction_tokens:c().nullish(),rejected_prediction_tokens:c().nullish()}).nullish()}).nullish(),Un=g({id:a().nullish(),created:c().nullish(),model:a().nullish(),choices:h(g({message:g({role:f("assistant").nullish(),content:a().nullish(),function_call:g({arguments:a(),name:a()}).nullish(),tool_calls:h(g({id:a().nullish(),type:f("function"),function:g({name:a(),arguments:a()})})).nullish()}),index:c(),logprobs:g({content:h(g({token:a(),logprob:c(),top_logprobs:h(g({token:a(),logprob:c()}))})).nullable()}).nullish(),finish_reason:a().nullish()})),usage:Dn}),Fn=r([g({id:a().nullish(),created:c().nullish(),model:a().nullish(),choices:h(g({delta:g({role:b(["assistant"]).nullish(),content:a().nullish(),function_call:g({name:a().optional(),arguments:a().optional()}).nullish(),tool_calls:h(g({index:c(),id:a().nullish(),type:f("function").nullish(),function:g({name:a().nullish(),arguments:a().nullish()})})).nullish()}).nullish(),logprobs:g({content:h(g({token:a(),logprob:c(),top_logprobs:h(g({token:a(),logprob:c()}))})).nullable()}).nullish(),finish_reason:a().nullish(),index:c()})),usage:Dn}),On]);function Bn(e){return e.startsWith("o")||e.startsWith("gpt-5")}function Vn(e){var t,s;return Bn(e)?null!=(s=null==(t=Jn[e])?void 0:t.systemMessageMode)?s:"developer":"system"}var Jn={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function Ln(e){return null==e?void 0:e.tokens.map((t,s)=>({token:t,logprob:e.token_logprobs[s],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[s]).map(([e,t])=>({token:e,logprob:t})):[]}))}var Hn=class{constructor(e,t,s){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=s}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:s,maxTokens:n,temperature:o,topP:r,topK:a,frequencyPenalty:i,presencePenalty:l,stopSequences:u,responseFormat:p,seed:c}){var d;const m=e.type,h=[];null!=a&&h.push({type:"unsupported-setting",setting:"topK"}),null!=p&&"text"!==p.type&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:g,stopSequences:f}=function({prompt:e,inputFormat:t,user:s="user",assistant:n="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let o="";"system"===e[0].role&&(o+=`${e[0].content}\n\n`,e=e.slice(1));for(const{role:r,content:a}of e)switch(r){case"system":throw new pe({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":o+=`${s}:\n${a.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new Fe({functionality:"images"})}}).join("")}\n\n`;break;case"assistant":o+=`${n}:\n${a.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new Fe({functionality:"tool-call messages"})}}).join("")}\n\n`;break;case"tool":throw new Fe({functionality:"tool messages"});default:throw new Error(`Unsupported role: ${r}`)}return o+=`${n}:\n`,{prompt:o,stopSequences:[`\n${s}:`]}}({prompt:s,inputFormat:t}),y=[...null!=f?f:[],...null!=u?u:[]],v={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:o,top_p:r,frequency_penalty:i,presence_penalty:l,seed:c,prompt:g,stop:y.length>0?y:void 0};switch(m){case"regular":if(null==(d=e.tools)?void 0:d.length)throw new Fe({functionality:"tools"});if(e.toolChoice)throw new Fe({functionality:"toolChoice"});return{args:v,warnings:h};case"object-json":throw new Fe({functionality:"object-json mode"});case"object-tool":throw new Fe({functionality:"object-tool mode"});default:throw new Error(`Unsupported type: ${m}`)}}async doGenerate(e){const{args:t,warnings:s}=this.getArgs(e),{responseHeaders:n,value:o,rawValue:r}=await at({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:t,failedResponseHandler:Pn,successfulResponseHandler:ut(Wn),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...i}=t,l=o.choices[0];return{text:l.text,usage:{promptTokens:o.usage.prompt_tokens,completionTokens:o.usage.completion_tokens},finishReason:Mn(l.finish_reason),logprobs:Ln(l.logprobs),rawCall:{rawPrompt:a,rawSettings:i},rawResponse:{headers:n,body:r},response:$n(o),warnings:s,request:{body:JSON.stringify(t)}}}async doStream(e){const{args:t,warnings:s}=this.getArgs(e),n={...t,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:o,value:r}=await at({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:n,failedResponseHandler:Pn,successfulResponseHandler:lt(Kn),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...i}=t;let l,u="unknown",p={promptTokens:Number.NaN,completionTokens:Number.NaN},c=!0;return{stream:r.pipeThrough(new TransformStream({transform(e,t){if(!e.success)return u="error",void t.enqueue({type:"error",error:e.error});const s=e.value;if("error"in s)return u="error",void t.enqueue({type:"error",error:s.error});c&&(c=!1,t.enqueue({type:"response-metadata",...$n(s)})),null!=s.usage&&(p={promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens});const n=s.choices[0];null!=(null==n?void 0:n.finish_reason)&&(u=Mn(n.finish_reason)),null!=(null==n?void 0:n.text)&&t.enqueue({type:"text-delta",textDelta:n.text});const o=Ln(null==n?void 0:n.logprobs);(null==o?void 0:o.length)&&(void 0===l&&(l=[]),l.push(...o))},flush(e){e.enqueue({type:"finish",finishReason:u,logprobs:l,usage:p})}})),rawCall:{rawPrompt:a,rawSettings:i},rawResponse:{headers:o},warnings:s,request:{body:JSON.stringify(n)}}}},Wn=g({id:a().nullish(),created:c().nullish(),model:a().nullish(),choices:h(g({text:a(),finish_reason:a(),logprobs:g({tokens:h(a()),token_logprobs:h(c()),top_logprobs:h(m(a(),c())).nullable()}).nullish()})),usage:g({prompt_tokens:c(),completion_tokens:c()})}),Kn=r([g({id:a().nullish(),created:c().nullish(),model:a().nullish(),choices:h(g({text:a(),finish_reason:a().nullish(),index:c(),logprobs:g({tokens:h(a()),token_logprobs:h(c()),top_logprobs:h(m(a(),c())).nullable()}).nullish()})),usage:g({prompt_tokens:c(),completion_tokens:c()}).nullish()}),On]),Gn=class{constructor(e,t,s){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=s}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,headers:t,abortSignal:s}){if(e.length>this.maxEmbeddingsPerCall)throw new Ne({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:n,value:o}=await at({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:He(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:Pn,successfulResponseHandler:ut(zn),abortSignal:s,fetch:this.config.fetch});return{embeddings:o.data.map(e=>e.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,rawResponse:{headers:n}}}},zn=g({data:h(g({embedding:h(c())})),usage:g({prompt_tokens:c()}).nullish()}),Yn={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},Xn=new Set(["gpt-image-1"]),Zn=class{constructor(e,t,s){this.modelId=e,this.settings=t,this.config=s,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return null!=(t=null!=(e=this.settings.maxImagesPerCall)?e:Yn[this.modelId])?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:s,aspectRatio:n,seed:o,providerOptions:r,headers:a,abortSignal:i}){var l,u,p,c;const d=[];null!=n&&d.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=o&&d.push({type:"unsupported-setting",setting:"seed"});const m=null!=(p=null==(u=null==(l=this.config._internal)?void 0:l.currentDate)?void 0:u.call(l))?p:new Date,{value:h,responseHeaders:g}=await at({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:He(this.config.headers(),a),body:{model:this.modelId,prompt:e,n:t,size:s,...null!=(c=r.openai)?c:{},...Xn.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:Pn,successfulResponseHandler:ut(Qn),abortSignal:i,fetch:this.config.fetch});return{images:h.data.map(e=>e.b64_json),warnings:d,response:{timestamp:m,modelId:this.modelId,headers:g}}}},Qn=g({data:h(g({b64_json:a()}))}),eo=g({include:h(a()).nullish(),language:a().nullish(),prompt:a().nullish(),temperature:c().min(0).max(1).nullish().default(0),timestampGranularities:h(b(["word","segment"])).nullish().default(["segment"])}),to={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},so=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:s}){var n,o,r,a,i;const l=ot({provider:"openai",providerOptions:s,schema:eo}),u=new FormData,p=e instanceof Uint8Array?new Blob([e]):new Blob([dt(e)]);if(u.append("model",this.modelId),u.append("file",new File([p],"audio",{type:t})),l){const e={include:null!=(n=l.include)?n:void 0,language:null!=(o=l.language)?o:void 0,prompt:null!=(r=l.prompt)?r:void 0,temperature:null!=(a=l.temperature)?a:void 0,timestamp_granularities:null!=(i=l.timestampGranularities)?i:void 0};for(const t in e){const s=e[t];void 0!==s&&u.append(t,String(s))}}return{formData:u,warnings:[]}}async doGenerate(e){var t,s,n,o,r,a;const i=null!=(n=null==(s=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:s.call(t))?n:new Date,{formData:l,warnings:u}=this.getArgs(e),{value:p,responseHeaders:c,rawValue:d}=await(async({url:e,headers:t,formData:s,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a})=>it({url:e,headers:t,body:{content:s,values:Object.fromEntries(s.entries())},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:r,fetch:a}))({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),formData:l,failedResponseHandler:Pn,successfulResponseHandler:ut(no),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=null!=p.language&&p.language in to?to[p.language]:void 0;return{text:p.text,segments:null!=(r=null==(o=p.words)?void 0:o.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?r:[],language:m,durationInSeconds:null!=(a=p.duration)?a:void 0,warnings:u,response:{timestamp:i,modelId:this.modelId,headers:c,body:d}}}},no=g({text:a(),language:a().nullish(),duration:c().nullish(),words:h(g({word:a(),start:c(),end:c()})).nullish()});function oo({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var ro=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:s,stopSequences:n,topP:o,topK:r,presencePenalty:a,frequencyPenalty:i,seed:l,prompt:u,providerMetadata:p,responseFormat:c}){var d,m,h;const g=[],f=function(e){if(e.startsWith("o")||e.startsWith("gpt-5"))return e.startsWith("o1-mini")||e.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1};return{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1}}(this.modelId),y=e.type;null!=r&&g.push({type:"unsupported-setting",setting:"topK"}),null!=l&&g.push({type:"unsupported-setting",setting:"seed"}),null!=a&&g.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=i&&g.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=n&&g.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:v,warnings:w}=function({prompt:e,systemMessageMode:t}){const s=[],n=[];for(const{role:o,content:r}of e)switch(o){case"system":switch(t){case"system":s.push({role:"system",content:r});break;case"developer":s.push({role:"developer",content:r});break;case"remove":n.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${t}`)}break;case"user":s.push({role:"user",content:r.map((e,t)=>{var s,n,o,r;switch(e.type){case"text":return{type:"input_text",text:e.text};case"image":return{type:"input_image",image_url:e.image instanceof URL?e.image.toString():`data:${null!=(s=e.mimeType)?s:"image/jpeg"};base64,${mt(e.image)}`,detail:null==(o=null==(n=e.providerMetadata)?void 0:n.openai)?void 0:o.imageDetail};case"file":if(e.data instanceof URL)throw new Fe({functionality:"File URLs in user messages"});if("application/pdf"===e.mimeType)return{type:"input_file",filename:null!=(r=e.filename)?r:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${e.data}`};throw new Fe({functionality:"Only PDF files are supported in user messages"})}})});break;case"assistant":for(const e of r)switch(e.type){case"text":s.push({role:"assistant",content:[{type:"output_text",text:e.text}]});break;case"tool-call":s.push({type:"function_call",call_id:e.toolCallId,name:e.toolName,arguments:JSON.stringify(e.args)})}break;case"tool":for(const e of r)s.push({type:"function_call_output",call_id:e.toolCallId,output:JSON.stringify(e.result)});break;default:throw new Error(`Unsupported role: ${o}`)}return{messages:s,warnings:n}}({prompt:u,systemMessageMode:f.systemMessageMode});g.push(...w);const b=ot({provider:"openai",providerOptions:p,schema:vo}),_=null==(d=null==b?void 0:b.strictSchemas)||d,x={model:this.modelId,input:v,temperature:s,top_p:o,max_output_tokens:t,..."json"===(null==c?void 0:c.type)&&{text:{format:null!=c.schema?{type:"json_schema",strict:_,name:null!=(m=c.name)?m:"response",description:c.description,schema:c.schema}:{type:"json_object"}}},metadata:null==b?void 0:b.metadata,parallel_tool_calls:null==b?void 0:b.parallelToolCalls,previous_response_id:null==b?void 0:b.previousResponseId,store:null==b?void 0:b.store,user:null==b?void 0:b.user,instructions:null==b?void 0:b.instructions,...f.isReasoningModel&&(null!=(null==b?void 0:b.reasoningEffort)||null!=(null==b?void 0:b.reasoningSummary))&&{reasoning:{...null!=(null==b?void 0:b.reasoningEffort)&&{effort:b.reasoningEffort},...null!=(null==b?void 0:b.reasoningSummary)&&{summary:b.reasoningSummary}}},...f.requiredAutoTruncation&&{truncation:"auto"}};switch(f.isReasoningModel&&(null!=x.temperature&&(x.temperature=void 0,g.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=x.top_p&&(x.top_p=void 0,g.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),y){case"regular":{const{tools:t,tool_choice:s,toolWarnings:n}=function({mode:e,strict:t}){var s;const n=(null==(s=e.tools)?void 0:s.length)?e.tools:void 0,o=[];if(null==n)return{tools:void 0,tool_choice:void 0,toolWarnings:o};const r=e.toolChoice,a=[];for(const l of n)switch(l.type){case"function":a.push({type:"function",name:l.name,description:l.description,parameters:l.parameters,strict:!!t||void 0});break;case"provider-defined":"openai.web_search_preview"===l.id?a.push({type:"web_search_preview",search_context_size:l.args.searchContextSize,user_location:l.args.userLocation}):o.push({type:"unsupported-tool",tool:l});break;default:o.push({type:"unsupported-tool",tool:l})}if(null==r)return{tools:a,tool_choice:void 0,toolWarnings:o};const i=r.type;switch(i){case"auto":case"none":case"required":return{tools:a,tool_choice:i,toolWarnings:o};case"tool":return"web_search_preview"===r.toolName?{tools:a,tool_choice:{type:"web_search_preview"},toolWarnings:o}:{tools:a,tool_choice:{type:"function",name:r.toolName},toolWarnings:o};default:throw new Fe({functionality:`Unsupported tool choice type: ${i}`})}}({mode:e,strict:_});return{args:{...x,tools:t,tool_choice:s},warnings:[...g,...n]}}case"object-json":return{args:{...x,text:{format:null!=e.schema?{type:"json_schema",strict:_,name:null!=(h=e.name)?h:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:g};case"object-tool":return{args:{...x,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:_}]},warnings:g};default:throw new Error(`Unsupported type: ${y}`)}}async doGenerate(e){var t,s,n,o,r,i,l;const{args:u,warnings:p}=this.getArgs(e),d=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:m,value:y,rawValue:v}=await at({url:d,headers:He(this.config.headers(),e.headers),body:u,failedResponseHandler:Pn,successfulResponseHandler:ut(g({id:a(),created_at:c(),error:g({message:a(),code:a()}).nullish(),model:a(),output:h(_("type",[g({type:f("message"),role:f("assistant"),content:h(g({type:f("output_text"),text:a(),annotations:h(g({type:f("url_citation"),start_index:c(),end_index:c(),url:a(),title:a()}))}))}),g({type:f("function_call"),call_id:a(),name:a(),arguments:a()}),g({type:f("web_search_call")}),g({type:f("computer_call")}),g({type:f("reasoning"),summary:h(g({type:f("summary_text"),text:a()}))})])),incomplete_details:g({reason:a()}).nullable(),usage:ao})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(y.error)throw new G({message:y.error.message,url:d,requestBodyValues:u,statusCode:400,responseHeaders:m,responseBody:v,isRetryable:!1});const w=y.output.filter(e=>"message"===e.type).flatMap(e=>e.content).filter(e=>"output_text"===e.type),b=y.output.filter(e=>"function_call"===e.type).map(e=>({toolCallType:"function",toolCallId:e.call_id,toolName:e.name,args:e.arguments})),x=null!=(s=null==(t=y.output.find(e=>"reasoning"===e.type))?void 0:t.summary)?s:null;return{text:w.map(e=>e.text).join("\n"),sources:w.flatMap(e=>e.annotations.map(e=>{var t,s,n;return{sourceType:"url",id:null!=(n=null==(s=(t=this.config).generateId)?void 0:s.call(t))?n:ze(),url:e.url,title:e.title}})),finishReason:oo({finishReason:null==(n=y.incomplete_details)?void 0:n.reason,hasToolCalls:b.length>0}),toolCalls:b.length>0?b:void 0,reasoning:x?x.map(e=>({type:"text",text:e.text})):void 0,usage:{promptTokens:y.usage.input_tokens,completionTokens:y.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:m,body:v},request:{body:JSON.stringify(u)},response:{id:y.id,timestamp:new Date(1e3*y.created_at),modelId:y.model},providerMetadata:{openai:{responseId:y.id,cachedPromptTokens:null!=(r=null==(o=y.usage.input_tokens_details)?void 0:o.cached_tokens)?r:null,reasoningTokens:null!=(l=null==(i=y.usage.output_tokens_details)?void 0:i.reasoning_tokens)?l:null}},warnings:p}}async doStream(e){const{args:t,warnings:s}=this.getArgs(e),{responseHeaders:n,value:o}=await at({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:Pn,successfulResponseHandler:lt(yo),abortSignal:e.abortSignal,fetch:this.config.fetch}),r=this;let a="unknown",i=NaN,l=NaN,u=null,p=null,c=null;const d={};let m=!1;return{stream:o.pipeThrough(new TransformStream({transform(e,t){var s,n,o,h,g,f,y,v;if(!e.success)return a="error",void t.enqueue({type:"error",error:e.error});const w=e.value;if(function(e){return"response.output_item.added"===e.type}(w))"function_call"===w.item.type&&(d[w.output_index]={toolName:w.item.name,toolCallId:w.item.call_id},t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:w.item.call_id,toolName:w.item.name,argsTextDelta:w.item.arguments}));else if(function(e){return"response.function_call_arguments.delta"===e.type}(w)){const e=d[w.output_index];null!=e&&t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:e.toolCallId,toolName:e.toolName,argsTextDelta:w.delta})}else!function(e){return"response.created"===e.type}(w)?!function(e){return"response.output_text.delta"===e.type}(w)?!function(e){return"response.reasoning_summary_text.delta"===e.type}(w)?!function(e){return"response.output_item.done"===e.type}(w)||"function_call"!==w.item.type?!function(e){return"response.completed"===e.type||"response.incomplete"===e.type}(w)?!function(e){return"response.output_text.annotation.added"===e.type}(w)?function(e){return"error"===e.type}(w)&&t.enqueue({type:"error",error:w}):t.enqueue({type:"source",source:{sourceType:"url",id:null!=(v=null==(y=(f=r.config).generateId)?void 0:y.call(f))?v:ze(),url:w.annotation.url,title:w.annotation.title}}):(a=oo({finishReason:null==(s=w.response.incomplete_details)?void 0:s.reason,hasToolCalls:m}),i=w.response.usage.input_tokens,l=w.response.usage.output_tokens,u=null!=(o=null==(n=w.response.usage.input_tokens_details)?void 0:n.cached_tokens)?o:u,p=null!=(g=null==(h=w.response.usage.output_tokens_details)?void 0:h.reasoning_tokens)?g:p):(d[w.output_index]=void 0,m=!0,t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:w.item.call_id,toolName:w.item.name,args:w.item.arguments})):t.enqueue({type:"reasoning",textDelta:w.delta}):t.enqueue({type:"text-delta",textDelta:w.delta}):(c=w.response.id,t.enqueue({type:"response-metadata",id:w.response.id,timestamp:new Date(1e3*w.response.created_at),modelId:w.response.model}))},flush(e){e.enqueue({type:"finish",finishReason:a,usage:{promptTokens:i,completionTokens:l},...(null!=u||null!=p)&&{providerMetadata:{openai:{responseId:c,cachedPromptTokens:u,reasoningTokens:p}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:n},request:{body:JSON.stringify(t)},warnings:s}}},ao=g({input_tokens:c(),input_tokens_details:g({cached_tokens:c().nullish()}).nullish(),output_tokens:c(),output_tokens_details:g({reasoning_tokens:c().nullish()}).nullish()}),io=g({type:f("response.output_text.delta"),delta:a()}),lo=g({type:b(["response.completed","response.incomplete"]),response:g({incomplete_details:g({reason:a()}).nullish(),usage:ao})}),uo=g({type:f("response.created"),response:g({id:a(),created_at:c(),model:a()})}),po=g({type:f("response.output_item.done"),output_index:c(),item:_("type",[g({type:f("message")}),g({type:f("function_call"),id:a(),call_id:a(),name:a(),arguments:a(),status:f("completed")})])}),co=g({type:f("response.function_call_arguments.delta"),item_id:a(),output_index:c(),delta:a()}),mo=g({type:f("response.output_item.added"),output_index:c(),item:_("type",[g({type:f("message")}),g({type:f("function_call"),id:a(),call_id:a(),name:a(),arguments:a()})])}),ho=g({type:f("response.output_text.annotation.added"),annotation:g({type:f("url_citation"),url:a(),title:a()})}),go=g({type:f("response.reasoning_summary_text.delta"),item_id:a(),output_index:c(),summary_index:c(),delta:a()}),fo=g({type:f("error"),code:a(),message:a(),param:a().nullish(),sequence_number:c()}),yo=r([io,lo,uo,po,co,mo,ho,go,fo,g({type:a()}).passthrough()]);var vo=g({metadata:w().nullish(),parallelToolCalls:d().nullish(),previousResponseId:a().nullish(),store:d().nullish(),user:a().nullish(),reasoningEffort:a().nullish(),strictSchemas:d().nullish(),instructions:a().nullish(),reasoningSummary:a().nullish()}),wo=g({});var bo={webSearchPreview:function({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:wo}}},_o=g({instructions:a().nullish(),speed:c().min(.25).max(4).default(1).nullish()}),xo=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:s="mp3",speed:n,instructions:o,providerOptions:r}){const a=[],i=ot({provider:"openai",providerOptions:r,schema:_o}),l={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:n,instructions:o};if(s&&(["mp3","opus","aac","flac","wav","pcm"].includes(s)?l.response_format=s:a.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${s}. Using mp3 instead.`})),i){const e={};for(const t in e){const s=e[t];void 0!==s&&(l[t]=s)}}return{requestBody:l,warnings:a}}async doGenerate(e){var t,s,n;const o=null!=(n=null==(s=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:s.call(t))?n:new Date,{requestBody:r,warnings:a}=this.getArgs(e),{value:i,responseHeaders:l,rawValue:u}=await at({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:r,failedResponseHandler:Pn,successfulResponseHandler:async({response:e,url:t,requestBodyValues:s})=>{const n=Ke(e);if(!e.body)throw new G({message:"Response body is empty",url:t,requestBodyValues:s,statusCode:e.status,responseHeaders:n,responseBody:void 0});try{const t=await e.arrayBuffer();return{responseHeaders:n,value:new Uint8Array(t)}}catch(o){throw new G({message:"Failed to read response as array buffer",url:t,requestBodyValues:s,statusCode:e.status,responseHeaders:n,responseBody:void 0,cause:o})}},abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:i,warnings:a,request:{body:JSON.stringify(r)},response:{timestamp:o,modelId:this.modelId,headers:l,body:u}}}};function Io(e={}){var t,s,n;const o=null!=(t=null==(r=e.baseURL)?void 0:r.replace(/\/$/,""))?t:"https://api.openai.com/v1";var r;const a=null!=(s=e.compatibility)?s:"compatible",i=null!=(n=e.name)?n:"openai",l=()=>({Authorization:`Bearer ${Xe({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(t,s={})=>new qn(t,s,{provider:`${i}.chat`,url:({path:e})=>`${o}${e}`,headers:l,compatibility:a,fetch:e.fetch}),p=(t,s={})=>new Hn(t,s,{provider:`${i}.completion`,url:({path:e})=>`${o}${e}`,headers:l,compatibility:a,fetch:e.fetch}),c=(t,s={})=>new Gn(t,s,{provider:`${i}.embedding`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),d=(t,s={})=>new Zn(t,s,{provider:`${i}.image`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),m=t=>new so(t,{provider:`${i}.transcription`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),h=t=>new xo(t,{provider:`${i}.speech`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),g=(e,t)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?p(e,t):u(e,t)},f=function(e,t){return g(e,t)};return f.languageModel=g,f.chat=u,f.completion=p,f.responses=t=>new ro(t,{provider:`${i}.responses`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),f.embedding=c,f.textEmbedding=c,f.textEmbeddingModel=c,f.image=d,f.imageModel=d,f.transcription=m,f.transcriptionModel=m,f.speech=h,f.speechModel=h,f.tools=bo,f}Io({compatibility:"strict"});const To={decay:R,inertia:R,tween:T,keyframes:T,spring:E},ko=e=>e/100;class So extends x{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:s,element:n,keyframes:o}=this.options,r=(null==n?void 0:n.KeyframeResolver)||I;this.resolver=new r(o,(e,t)=>this.onKeyframesResolved(e,t),t,s,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:s=0,repeatDelay:n=0,repeatType:o,velocity:r=0}=this.options,a=M(t)?t:To[t]||T;let i,l;a!==T&&"number"!=typeof e[0]&&(i=k(ko,S(e[0],e[1])),e=[0,100]);const u=a({...this.options,keyframes:e});"mirror"===o&&(l=a({...this.options,keyframes:[...e].reverse(),velocity:-r})),null===u.calculatedDuration&&(u.calculatedDuration=j(u));const{calculatedDuration:p}=u,c=p+n;return{generator:u,mirroredGenerator:l,mapPercentToKeyframes:i,calculatedDuration:p,resolvedDuration:c,totalDuration:c*(s+1)-n}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e,t=!1){const{resolved:s}=this;if(!s){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:n,generator:o,mirroredGenerator:r,mapPercentToKeyframes:a,keyframes:i,calculatedDuration:l,totalDuration:u,resolvedDuration:p}=s;if(null===this.startTime)return o.next(0);const{delay:c,repeat:d,repeatType:m,repeatDelay:h,onUpdate:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const f=this.currentTime-c*(this.speed>=0?1:-1),y=this.speed>=0?f<0:f>u;this.currentTime=Math.max(f,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=u);let v=this.currentTime,w=o;if(d){const e=Math.min(this.currentTime,u)/p;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===m?(s=1-s,h&&(s-=h/p)):"mirror"===m&&(w=r)),v=O(0,1,s)*p}const b=y?{done:!1,value:i[0]}:w.next(v);a&&(b.value=a(b.value));let{done:_}=b;y||null===l||(_=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const x=null===this.holdTime&&("finished"===this.state||"running"===this.state&&_);return x&&void 0!==n&&(b.value=N(i,this.options,n)),g&&g(b.value),x&&this.finish(),b}get duration(){const{resolved:e}=this;return e?A(e.calculatedDuration):0}get time(){return A(this.currentTime)}set time(e){e=P(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=A(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=C,onPlay:t,startTime:s}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),t&&t();const n=this.driver.now();null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=n):this.startTime=null!=s?s:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}function Eo(e,{min:t,max:s},n){return void 0!==t&&e<t?e=n?$(t,e,n.min):Math.max(e,t):void 0!==s&&e>s&&(e=n?$(s,e,n.max):Math.min(e,s)),e}function Ro(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function jo(e,{top:t,left:s,bottom:n,right:o}){return{x:Ro(e.x,s,o),y:Ro(e.y,t,n)}}function No(e,t){let s=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,n]=[n,s]),{min:s,max:n}}function Ao(e,t){return{x:No(e.x,t.x),y:No(e.y,t.y)}}function Co(e,t){let s=.5;const n=q(e),o=q(t);return o>n?s=D(t.min,t.max-n,e.min):n>o&&(s=D(e.min,e.max-o,t.min)),O(0,1,s)}function Mo(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}const Oo=.35;function Po(e=.35){return!1===e?e=0:!0===e&&(e=Oo),{x:$o(e,"left","right"),y:$o(e,"top","bottom")}}function $o(e,t,s){return{min:qo(e,t),max:qo(e,s)}}function qo(e,t){return"number"==typeof e?e:e[t]||0}export{So as M,Eo as a,Ao as b,jo as c,Oo as d,Mo as e,Co as f,Io as g,Zs as h,Po as r};
